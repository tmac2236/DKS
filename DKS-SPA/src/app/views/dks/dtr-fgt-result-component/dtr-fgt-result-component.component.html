<div class="animated fadeIn">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header">
          <div class="row">
            <strong class ="col-11" style="font-size: 20px;color:#000000;">LAB Test Report Maintain</strong>
              <div class="col-1 btn-group" dropdown>
                <button id="button-basic" dropdownToggle type="button" class="btn btn-primary dropdown-toggle"
                        aria-controls="dropdown-basic">
                        <strong *ngIf="this.sDevDtrFgtResult.loginUser">{{ this.sDevDtrFgtResult.loginUser }}</strong> <span class="caret"></span>
                </button>
                <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                    role="menu" aria-labelledby="button-basic">
                  <li role="menuitem"><a class="dropdown-item" href="javascript:;" (click)="this.utility.logout()"><img src="../assets/systemImg/exit.png" class="topImg" width="25" height="25"/>  Log Out</a></li>
                </ul>                
            </div>
          </div>          
        </div>
        <div class="card-body">
          <form class="form" #addQueryReportDataForm="ngForm">
            <!-- first column-->
            <div class="row">
              <div class="form-group col-6 mr-1">
                <label>Model No</label>
                <input
                  class="col-form-label"
                  type="text"
                  name="modelNo"
                  [(ngModel)]="sDevDtrFgtResult.modelNo"
                />
                <label>Article</label>
                <input
                  class="col-form-label"
                  type="text"
                  name="article"
                  [(ngModel)]="sDevDtrFgtResult.article"
                />
              </div>
              <div class="form-group col-6"></div>
            </div>
            <!-- Second column-->
            <div class="row">
              <div class="form-group col-6 mr-1">
                <label>Model Name</label>
                <input
                  class="col-form-label"
                  type="text"
                  name="modelName"
                  [(ngModel)]="sDevDtrFgtResult.modelName"
                />
                <button
                  class="btn btn-primary mr-1"
                  type="button"
                  [disabled]='checkSearchValid()'
                  (click)="search()"
                >
                  Search
                </button>
                <button
                  class="btn btn-primary mr-1"
                  type="button"
                  (click)="openAddFgtResultModal('addFgtResult')"
                  [disabled]="!(articleList?.length > 0)"
                >
                  Add A Report
                </button>
              </div>
              <div class="form-group col-6"></div>
            </div>
          </form>
        </div>
        <div class="row" *ngIf="result.length > 0">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table text-center text-nowrap table-striped">
                    <!--text-nowrap不換行-->
                    <!--套版分頁<table datatable id="f340Sche" class="table text-center table-striped">-->
                    <thead>
                      <tr class="table-info">
                        <th>Model Name</th>
                        <th>Model No</th>
                        <th>Article</th>
                        <th>Stage</th>
                        <th>Lab No</th>

                        <th>Type</th>
                        <th>Kind</th>
                        <th>Test Result</th>
                        <th>Test Report</th>
                        <th>Remark</th>

                        <th>Part Name</th>
                        <th>TreatMent(zh-TW)</th>
                        <th>TreatMent(En)</th>
                        <th>Maintain Report</th>
                        <th>Upload Time</th>
                        <th>Upload User</th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container *ngFor="let item of result; let i = index">
                        <tr>
                          <td>
                            <!--
                            <img
                              src="../assets/systemImg/edit.png"
                              width="35"
                              height="35"
                              (click)="openAddFgtResultModal('editFgtResult',item)"/>
                            -->                                
                            <img
                              src="../assets/systemImg/delete.png"
                              width="35"
                              height="35"
                              (click)="deleteDevDtrFgtResult(item)"/>                            
                            {{ item.modelName }}
                          </td>
                          <td>{{ item.modelNo }}</td>
                          <td>{{ item.article }}</td>
                          <td>{{ item.stage }}</td>
                          <td>{{ item.labNo }}</td>

                          <td>{{ item.type }}</td>
                          <td>{{ item.kind }}</td>
                          <td>{{ item.result }}</td>
                          <td>{{ item.fileName }}</td>
                          <td>{{ item.remark }}</td>

                          <td>{{ item.partName }}</td>
                          <td>{{ item.treatmentZh }}</td>
                          <td>{{ item.treatmentEn }}</td>
                          <!--Maintain-->
                          <td [hidden]="false">
                            <img
                            src="../assets/systemImg/download-pdf.png"
                            class="mr-1"
                            width="40"
                            height="40"
                            [style.visibility]="
                              item.fileName?.length < 1 ? 'hidden' : 'visible'
                            "
                            (click)="viewPdf(item)"
                            />
                            <label
                              class="btn btn-success mt-2"
                              for="fileUpload{{ item.labNo }}"
                              tooltip="{{ this.hintMsg.uploadPic }}"
                              placement="right"
                              >+</label
                            >
                            <input
                              id="fileUpload{{ item.labNo }}"
                              type="file"
                              style="display: none"
                              accept=".pdf"
                              (click)="this.utility.reset($event)"
                              (change)="
                                uploadPdfDtrFgtResult($event.target.files, item)
                              "
                            />
                            <!--Delete Btn
                            <img
                              [style.visibility]="
                                item.fileName == undefined ||
                                item.fileName == null
                                  ? 'hidden'
                                  : 'visible'
                              "
                              src="../assets/systemImg/delete.png"
                              width="35"
                              height="35"
                              (click)="removePdfDtrFgtResult(item)"
                            />
                            -->
                          </td>
                          <td>{{ item.upday  | date: "yyyy/MM/dd HH:mm:ss"  }}</td>
                          <td>{{ item.upusr }}</td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--addFgtResultModal-->
<div
  bsModal
  #addFgtResultModal="bs-modal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-info modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Pleas add a FGT result</h4>
        <button
          type="button"
          class="close"
          (click)="closeModal('addFgtResult')"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- first column-->
        <div class="row">
          <div class="col-2">
            <div class="form-group">
              <label for="modalModelName" class="col-form-label"
                >Model Name</label
              >
              <input type="text" class="form-control" id="modalModelName" [(ngModel)]="addAModel.modelName" readonly/>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label for="modalModelNo" class="col-form-label">Model No</label>
              <input type="text" class="form-control" id="modalModelNo" [(ngModel)]="addAModel.modelNo" readonly/>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label for="modalArticle" class="col-form-label">Article</label>
              <label style="color:red;">*</label>
              <div class="w-100"></div>
              <select
              id="modalArticle"
              class="form-control"
              [(ngModel)]="addAModel.article"
              (change)="selectArticle()"
              (change)="getPartName4DtrFgt()"
              >
                <option
                *ngFor="let atc of articleList"
                value="{{ atc.article }}">
                {{ atc.article }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label for="modalStage" class="col-form-label">Stage</label>
              <label style="color:red;">*</label>
              <div class="w-100"></div>
              <select
              id="modalStage"
              class="form-control"
              [(ngModel)]="addAModel.stage"
              (change)="getPartName4DtrFgt()"
              >
                <option value = "CR2" selected>CR2</option>
                <option value = "SMS" selected>SMS</option>
                <option value = "MCS" selected>MCS</option>
                <option value = "CS1" selected>CS1</option>
                <option value = "CS2" selected>CS2</option>
                <option value = "CS3" selected>CS3</option>
              </select>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label for="modalKind" class="col-form-label">Kind</label>
              <label style="color:red;">*</label>
              <div class="w-100"></div>
              <select
              id="modalKind"
              class="form-control"
              [(ngModel)]="addAModel.kind"
              (change)="getPartName4DtrFgt()"
              >
                <option value = "FGT" selected>FGT</option>
                <option value = "CMA" selected>CMA</option>
                <option value = "FIT" selected>FIT</option>
                <option value = "WEAR" selected>WEAR</option>
                <option value = "CT" selected>Component Test</option>
              </select>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label for="modalType" class="col-form-label">Type</label>
              <label style="color:red;">*</label>
              <div class="w-100"></div>
              <select
              id="modalType"
              class="form-control"
              [(ngModel)]="addAModel.type"
              >
                <option value = "Article" selected>Article</option>
                <option value = "Model No" selected>Model No</option>
                <option value = "Model Name" selected>Model Name</option>
              </select>
            </div>
          </div>
        </div>
        <!-- Second column-->
        <div class="row">
          <div class="col-2">
            <div class="form-group">
              <label for="modalLabNo" class="col-form-label">Lab No</label>
              <label style="color:red;">*</label>
              <input type="text" class="form-control" id="modalLabNo" [(ngModel)]="addAModel.labNo" />
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label for="modalTestResult" class="col-form-label"
                >Test Result</label>
              <label style="color:red;">*</label>
              <div class="w-100"></div>
              <select
              id="modalTestResult"
              class="form-control"
              [(ngModel)]="addAModel.result"
              >
                <option value = "PASS" selected>PASS</option>
                <option value = "FAIL" selected>FAIL</option>
              </select>
            </div>
          </div>
          <div class="col-4" *ngIf="this.partNameList?.length > 0 ">
            <div class="form-group">
              <input type="text" class="form-control" id="modalPartNo" [(ngModel)]="addAModel.partNo" [hidden]="true"/>
              <label for="modalPartName" class="col-form-label">Part Name</label>
              <label style="color:red;">*</label>
              <div class="w-100"></div>
              <select
              id="modalPartName"
              class="form-control"
              [(ngModel)]="addAModel.partName"
              (change)="showPartNameDetail()"
              >
                <option
                *ngFor="let ptn of partNameList"
                value="{{ ptn.partName }}">
                {{ ptn.partName }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-4" *ngIf="this.partNameList?.length > 0 ">
            <div class="form-group">
              <label for="modalTreatMent" class="col-form-label"
                >TreatMent</label>
              <input type="text" class="form-control" id="modalTreatMent" value="{{addAModelTreatment}}" readonly/>
            </div>
          </div>
        </div>
        <!-- Third column-->
        <div class="row">
          <div class="col-12">
            <div class="form-group">
              <label for="modalRemark" class="col-form-label">Remark</label>
              <textarea class="form-control" id="modalRemark" [(ngModel)]="addAModel.remark"></textarea>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="row">
          <div class="col-12">
            <button
              type="button"
              class="btn btn-success btn-lg mt-2 mr-4"
              (click)="saveAFgtResult()"
            >
              Save
            </button>
            <button
              type="button"
              class="btn btn-secondary btn-lg mt-2"
              (click)="closeModal('addFgtResult')"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--addFgtResultModal-->
<ngx-spinner
  bdColor="rgba(0, 0, 0, 0.8)"
  size="large"
  color="#fff"
  type="square-jelly-box"
  [fullScreen]="true"
  ><p style="color: white">Loading LAB Test Report Maintain...</p></ngx-spinner
>
